---
import { generateOgImage } from '../../utils/ogp';
import { formatJapaneseDate, formatDate } from '../../utils/date';
import { writeFile } from 'fs/promises';

interface Props {
  date: string;
  content: string;
  isDetailPage?: boolean;
}

const { date } = Astro.props;
const formattedJapaneseDate = date ? formatJapaneseDate(date) : '';
const formattedDate = date ? formatDate(new Date(date)) : '';

if (date) {
  const ogImageBuffer = await generateOgImage(formattedJapaneseDate);
  const ogImagePath = `${process.cwd()}/public/ogp/${formattedDate}.png`;
  await writeFile(ogImagePath, ogImageBuffer);
}

const { content, isDetailPage = false } = Astro.props;
---

<div class={`diary-content ${isDetailPage ? 'detail-view' : ''}`}>
  {content}
</div>

<style>
  .diary-content {
    font-family: 'Shippori Mincho', serif;
    font-size: 1.5rem;
    line-height: 2;
    color: #333;
    text-align: justify;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .diary-content:not(.detail-view) {
    writing-mode: horizontal-tb;
    max-width: 600px;
  }

  .diary-content.detail-view {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    height: 500px;
    margin-left: auto;
  }

  @media (max-width: 768px) {
    .diary-content:not(.detail-view) {
      max-width: 100%;
    }

    .diary-content.detail-view {
      height: 400px;
      font-size: 1.25rem;
      overflow-x: overlay;
      padding-bottom: 1.5rem;
    }
  }
</style>